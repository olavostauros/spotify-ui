---
// Hamburger menu button for mobile navigation
import Icon from './Icon.astro';
---

<button
  id="hamburger-btn"
  class="fixed top-4 left-4 z-[60] p-2 bg-spotify-light-gray/90 backdrop-blur-sm rounded-md lg:hidden hover:bg-spotify-light-gray transition-colors text-white"
  aria-label="Toggle menu"
  aria-expanded="false"
>
  <Icon name="menu" class="w-6 h-6" id="menu-icon" />
  <Icon name="x" class="w-6 h-6 hidden" id="close-icon" />
</button>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const hamburger = document.getElementById('hamburger-btn');
    const sidebar = document.querySelector('.drawer') as HTMLElement;
    const backdrop = document.getElementById('drawer-backdrop');
    const menuIcon = document.getElementById('menu-icon');
    const closeIcon = document.getElementById('close-icon');

    if (!hamburger || !sidebar || !backdrop || !menuIcon || !closeIcon) return;

    const toggleDrawer = () => {
      const isOpen = sidebar.classList.contains('translate-x-0');

      if (isOpen) {
        // Close drawer
        sidebar.classList.remove('translate-x-0');
        sidebar.classList.add('-translate-x-full');
        backdrop.classList.add('hidden');
        menuIcon.classList.remove('hidden');
        closeIcon.classList.add('hidden');
        hamburger.setAttribute('aria-expanded', 'false');
        document.body.style.overflow = '';
      } else {
        // Open drawer
        sidebar.classList.add('translate-x-0');
        sidebar.classList.remove('-translate-x-full');
        backdrop.classList.remove('hidden');
        menuIcon.classList.add('hidden');
        closeIcon.classList.remove('hidden');
        hamburger.setAttribute('aria-expanded', 'true');
        document.body.style.overflow = 'hidden';
      }
    };

    hamburger.addEventListener('click', toggleDrawer);
    backdrop.addEventListener('click', toggleDrawer);

    // Escape key support
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape' && sidebar.classList.contains('translate-x-0')) {
        toggleDrawer();
      }
    });

    // Close drawer on window resize to desktop
    let resizeTimer: number;
    window.addEventListener('resize', () => {
      clearTimeout(resizeTimer);
      resizeTimer = setTimeout(() => {
        if (window.innerWidth >= 1024 && sidebar.classList.contains('translate-x-0')) {
          toggleDrawer();
        }
      }, 250);
    });
  });
</script>
